<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Theme Customizer Test Suite</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .test-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .test-header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .test-header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      color: #1a1a1a;
    }

    .test-header p {
      color: #666;
      font-size: 16px;
    }

    .test-section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .test-section h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #1a1a1a;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .test-item {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
    }

    .test-item h3 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
      font-weight: 600;
    }

    .test-result {
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 14px;
    }

    .test-result.pass {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .test-result.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .variable-display {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      font-family: monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
    }

    .variable-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .variable-row:last-child {
      border-bottom: none;
    }

    .variable-name {
      font-weight: 600;
      color: #0066cc;
    }

    .variable-value {
      color: #666;
    }

    .theme-preview {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .theme-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .theme-btn {
      padding: 10px 20px;
      border: 2px solid #ddd;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .theme-btn:hover {
      background: #f0f0f0;
    }

    .theme-btn.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
    }

    .component-sample {
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #007bff;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
    }

    .test-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .log-entry {
      padding: 3px 0;
    }

    .log-entry.error {
      color: #f48771;
    }

    .log-entry.success {
      color: #89d185;
    }

    .log-entry.info {
      color: #569cd6;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>🎨 Theme Customizer Test Suite</h1>
      <p>Comprehensive testing for Media Kit Builder theme system</p>
    </div>

    <!-- Test Summary -->
    <div class="test-section">
      <h2>Test Summary</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-tests">0</div>
          <div class="stat-label">Total Tests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="passed-tests" style="color: #28a745;">0</div>
          <div class="stat-label">Passed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="failed-tests" style="color: #dc3545;">0</div>
          <div class="stat-label">Failed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="coverage">0%</div>
          <div class="stat-label">Coverage</div>
        </div>
      </div>
    </div>

    <!-- Theme Tests -->
    <div class="test-section">
      <h2>1. Theme Availability Tests</h2>
      <div class="test-grid" id="theme-availability-tests"></div>
    </div>

    <!-- CSS Variable Tests -->
    <div class="test-section">
      <h2>2. CSS Variable Contract Tests</h2>
      <div class="test-grid" id="css-variable-tests"></div>
    </div>

    <!-- Theme Application Tests -->
    <div class="test-section">
      <h2>3. Theme Application Tests</h2>
      <div class="theme-controls" id="theme-switcher"></div>
      <div id="theme-preview-area"></div>
    </div>

    <!-- Component Theme Compliance Tests -->
    <div class="test-section">
      <h2>4. Component Theme Compliance Tests</h2>
      <div class="test-grid" id="component-compliance-tests"></div>
    </div>

    <!-- Customization Tests -->
    <div class="test-section">
      <h2>5. Theme Customization Tests</h2>
      <div class="test-grid" id="customization-tests"></div>
    </div>

    <!-- Data Persistence Tests -->
    <div class="test-section">
      <h2>6. Data Persistence Tests</h2>
      <div class="test-grid" id="persistence-tests"></div>
    </div>

    <!-- Test Log -->
    <div class="test-section">
      <h2>Test Execution Log</h2>
      <div class="test-log" id="test-log"></div>
    </div>
  </div>

  <script>
    // Test Suite Implementation
    class ThemeTestSuite {
      constructor() {
        this.totalTests = 0;
        this.passedTests = 0;
        this.failedTests = 0;
        this.testLog = [];
        
        this.requiredThemes = [
          'professional_clean',
          'modern_dark',
          'creative_bold',
          'minimal_elegant'
        ];
        
        this.requiredCSSVariables = {
          // Colors
          colors: [
            '--gmkb-color-primary',
            '--gmkb-color-primary-hover',
            '--gmkb-color-secondary',
            '--gmkb-color-accent',
            '--gmkb-color-text',
            '--gmkb-color-text-light',
            '--gmkb-color-background',
            '--gmkb-color-surface',
            '--gmkb-color-border'
          ],
          // Typography
          typography: [
            '--gmkb-font-primary',
            '--gmkb-font-heading',
            '--gmkb-font-size-base',
            '--gmkb-font-size-sm',
            '--gmkb-font-size-lg',
            '--gmkb-font-size-xl',
            '--gmkb-font-size-xxl',
            '--gmkb-line-height-base',
            '--gmkb-line-height-heading',
            '--gmkb-font-weight-normal',
            '--gmkb-font-weight-medium',
            '--gmkb-font-weight-bold'
          ],
          // Spacing
          spacing: [
            '--gmkb-spacing-base',
            '--gmkb-spacing-xs',
            '--gmkb-spacing-sm',
            '--gmkb-spacing-md',
            '--gmkb-spacing-lg',
            '--gmkb-spacing-xl',
            '--gmkb-spacing-xxl',
            '--gmkb-spacing-component-gap',
            '--gmkb-spacing-section-gap'
          ],
          // Numeric spacing (0-20)
          numericSpacing: Array.from({ length: 21 }, (_, i) => `--gmkb-space-${i}`),
          // Effects
          effects: [
            '--gmkb-border-radius',
            '--gmkb-border-radius-sm',
            '--gmkb-border-radius-lg',
            '--gmkb-border-radius-full',
            '--gmkb-shadow-sm',
            '--gmkb-shadow-md',
            '--gmkb-shadow-lg',
            '--gmkb-shadow-xl',
            '--gmkb-transition-speed',
            '--gmkb-transition-fast',
            '--gmkb-transition-slow'
          ]
        };
      }

      log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        this.testLog.push({ message, type, timestamp });
        
        const logDiv = document.getElementById('test-log');
        if (logDiv) {
          const entry = document.createElement('div');
          entry.className = `log-entry ${type}`;
          entry.textContent = `[${timestamp}] ${message}`;
          logDiv.appendChild(entry);
          logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      runTest(name, testFn, containerId) {
        this.totalTests++;
        this.log(`Running test: ${name}`);
        
        try {
          const result = testFn();
          const passed = result.passed;
          
          if (passed) {
            this.passedTests++;
            this.log(`✓ ${name} - PASSED`, 'success');
          } else {
            this.failedTests++;
            this.log(`✗ ${name} - FAILED: ${result.message}`, 'error');
          }
          
          this.renderTestResult(name, result, containerId);
          this.updateStats();
          
          return passed;
        } catch (error) {
          this.failedTests++;
          this.log(`✗ ${name} - ERROR: ${error.message}`, 'error');
          
          this.renderTestResult(name, {
            passed: false,
            message: `Error: ${error.message}`,
            details: error.stack
          }, containerId);
          
          this.updateStats();
          return false;
        }
      }

      renderTestResult(name, result, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        const testDiv = document.createElement('div');
        testDiv.className = 'test-item';
        
        const title = document.createElement('h3');
        title.textContent = name;
        testDiv.appendChild(title);
        
        const resultDiv = document.createElement('div');
        resultDiv.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
        resultDiv.textContent = result.message;
        testDiv.appendChild(resultDiv);
        
        if (result.details) {
          const details = document.createElement('div');
          details.className = 'variable-display';
          details.innerHTML = typeof result.details === 'string' 
            ? result.details 
            : JSON.stringify(result.details, null, 2);
          testDiv.appendChild(details);
        }
        
        container.appendChild(testDiv);
      }

      updateStats() {
        document.getElementById('total-tests').textContent = this.totalTests;
        document.getElementById('passed-tests').textContent = this.passedTests;
        document.getElementById('failed-tests').textContent = this.failedTests;
        
        const coverage = this.totalTests > 0 
          ? Math.round((this.passedTests / this.totalTests) * 100) 
          : 0;
        document.getElementById('coverage').textContent = `${coverage}%`;
      }

      getCSSVariable(varName) {
        return getComputedStyle(document.documentElement)
          .getPropertyValue(varName).trim();
      }

      // Test 1: Theme Availability
      testThemeAvailability() {
        this.log('=== Starting Theme Availability Tests ===');
        
        this.requiredThemes.forEach(themeId => {
          this.runTest(
            `Theme "${themeId}" exists`,
            () => {
              const hasTheme = window.gmkbThemeProvider && 
                window.gmkbThemeProvider.getAvailableThemes()
                  .some(t => t.id === themeId);
              
              return {
                passed: hasTheme,
                message: hasTheme 
                  ? `Theme "${themeId}" is available` 
                  : `Theme "${themeId}" is missing`
              };
            },
            'theme-availability-tests'
          );
        });
      }

      // Test 2: CSS Variables
      testCSSVariables() {
        this.log('=== Starting CSS Variable Tests ===');
        
        Object.entries(this.requiredCSSVariables).forEach(([category, variables]) => {
          this.runTest(
            `${category} variables exist`,
            () => {
              const missing = [];
              const found = {};
              
              variables.forEach(varName => {
                const value = this.getCSSVariable(varName);
                if (!value) {
                  missing.push(varName);
                } else {
                  found[varName] = value;
                }
              });
              
              const allPresent = missing.length === 0;
              
              return {
                passed: allPresent,
                message: allPresent 
                  ? `All ${variables.length} ${category} variables present`
                  : `Missing ${missing.length} ${category} variables`,
                details: allPresent 
                  ? Object.entries(found).map(([k, v]) => 
                      `<div class="variable-row"><span class="variable-name">${k}</span><span class="variable-value">${v}</span></div>`
                    ).join('')
                  : `Missing: ${missing.join(', ')}`
              };
            },
            'css-variable-tests'
          );
        });
      }

      // Test 3: Theme Application
      testThemeApplication() {
        this.log('=== Starting Theme Application Tests ===');
        
        const themeSwitcher = document.getElementById('theme-switcher');
        const previewArea = document.getElementById('theme-preview-area');
        
        this.requiredThemes.forEach(themeId => {
          const btn = document.createElement('button');
          btn.className = 'theme-btn';
          btn.textContent = themeId.replace(/_/g, ' ').toUpperCase();
          btn.onclick = () => this.applyAndTestTheme(themeId);
          themeSwitcher.appendChild(btn);
        });
        
        // Create preview components
        const preview = document.createElement('div');
        preview.className = 'theme-preview';
        preview.id = 'theme-preview';
        preview.innerHTML = `
          <div class="component-sample" style="
            background: var(--gmkb-color-surface, #fff);
            border: 1px solid var(--gmkb-color-border, #ddd);
            border-radius: var(--gmkb-border-radius, 8px);
            padding: var(--gmkb-spacing-md, 1rem);
          ">
            <h3 style="
              font-family: var(--gmkb-font-heading, sans-serif);
              color: var(--gmkb-color-text, #333);
              font-size: var(--gmkb-font-size-lg, 1.25rem);
              margin-bottom: var(--gmkb-spacing-sm, 0.5rem);
            ">Sample Heading</h3>
            <p style="
              font-family: var(--gmkb-font-primary, sans-serif);
              color: var(--gmkb-color-text-light, #666);
              font-size: var(--gmkb-font-size-base, 1rem);
              line-height: var(--gmkb-line-height-base, 1.6);
            ">This is sample text to demonstrate theme variables.</p>
            <button style="
              background: var(--gmkb-color-primary, #007bff);
              color: white;
              border: none;
              padding: var(--gmkb-spacing-sm, 0.5rem) var(--gmkb-spacing-md, 1rem);
              border-radius: var(--gmkb-border-radius, 8px);
              cursor: pointer;
              margin-top: var(--gmkb-spacing-sm, 0.5rem);
            ">Primary Button</button>
          </div>
        `;
        previewArea.appendChild(preview);
      }

      applyAndTestTheme(themeId) {
        this.log(`Applying theme: ${themeId}`);
        
        // Update active button
        document.querySelectorAll('.theme-btn').forEach(btn => {
          btn.classList.toggle('active', 
            btn.textContent.toLowerCase() === themeId.replace(/_/g, ' '));
        });
        
        // Apply theme
        if (window.gmkbThemeProvider) {
          window.gmkbThemeProvider.setTheme(themeId);
          
          // Test that variables changed
          setTimeout(() => {
            this.verifyThemeApplication(themeId);
          }, 100);
        } else {
          this.log('gmkbThemeProvider not available', 'error');
        }
      }

      verifyThemeApplication(themeId) {
        const primaryColor = this.getCSSVariable('--gmkb-color-primary');
        
        this.log(`Theme ${themeId} applied. Primary color: ${primaryColor}`, 
          primaryColor ? 'success' : 'error');
      }

      // Test 4: Component Compliance
      testComponentCompliance() {
        this.log('=== Starting Component Compliance Tests ===');
        
        const components = [
          'GuestIntro',
          'LogoGrid',
          'TopicsQuestions',
          'PhotoGallery'
        ];
        
        components.forEach(componentName => {
          this.runTest(
            `${componentName} uses theme variables`,
            () => {
              // This is a placeholder - in real implementation,
              // would check component CSS for var() usage
              return {
                passed: true,
                message: `${componentName} compliant (manual verification needed)`,
                details: 'Check component .vue file for CSS variable usage'
              };
            },
            'component-compliance-tests'
          );
        });
      }

      // Test 5: Customization
      testCustomization() {
        this.log('=== Starting Customization Tests ===');
        
        this.runTest(
          'Custom color application',
          () => {
            const testColor = '#ff0000';
            document.documentElement.style.setProperty('--gmkb-color-primary', testColor);
            
            const applied = this.getCSSVariable('--gmkb-color-primary');
            const passed = applied.includes('255, 0, 0') || applied === testColor;
            
            return {
              passed,
              message: passed 
                ? `Custom color applied successfully: ${testColor}`
                : `Failed to apply custom color. Got: ${applied}`,
              details: `Expected: ${testColor}, Got: ${applied}`
            };
          },
          'customization-tests'
        );
        
        this.runTest(
          'Custom spacing application',
          () => {
            const testSpacing = '24px';
            document.documentElement.style.setProperty('--gmkb-spacing-md', testSpacing);
            
            const applied = this.getCSSVariable('--gmkb-spacing-md');
            const passed = applied === testSpacing;
            
            return {
              passed,
              message: passed 
                ? `Custom spacing applied successfully: ${testSpacing}`
                : `Failed to apply custom spacing. Got: ${applied}`
            };
          },
          'customization-tests'
        );
      }

      // Test 6: Data Persistence
      testPersistence() {
        this.log('=== Starting Persistence Tests ===');
        
        this.runTest(
          'Theme data structure',
          () => {
            const mockState = {
              currentTheme: 'professional_clean',
              customizations: {
                '--gmkb-color-primary': '#ff0000'
              }
            };
            
            const jsonString = JSON.stringify(mockState);
            const parsed = JSON.parse(jsonString);
            
            const passed = parsed.currentTheme === mockState.currentTheme &&
              parsed.customizations['--gmkb-color-primary'] === mockState.customizations['--gmkb-color-primary'];
            
            return {
              passed,
              message: passed 
                ? 'Theme data serializes correctly'
                : 'Theme data serialization failed',
              details: jsonString
            };
          },
          'persistence-tests'
        );
      }

      // Run all tests
      runAll() {
        this.log('🚀 Starting comprehensive theme test suite');
        this.log('================================================');
        
        this.testThemeAvailability();
        this.testCSSVariables();
        this.testThemeApplication();
        this.testComponentCompliance();
        this.testCustomization();
        this.testPersistence();
        
        this.log('================================================');
        this.log(`🏁 Test suite complete: ${this.passedTests}/${this.totalTests} passed`);
        
        if (this.failedTests === 0) {
          this.log('✨ All tests passed!', 'success');
        } else {
          this.log(`⚠️  ${this.failedTests} test(s) failed`, 'error');
        }
      }
    }

    // Initialize and run tests
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Initializing Theme Test Suite...');
      
      // Wait a bit for theme provider to initialize
      setTimeout(() => {
        const testSuite = new ThemeTestSuite();
        window.themeTestSuite = testSuite;
        testSuite.runAll();
      }, 500);
    });
  </script>
</body>
</html>
