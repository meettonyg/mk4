var GMKB=function(h){"use strict";var Se=Object.defineProperty;var fe=(h,p,S)=>p in h?Se(h,p,{enumerable:!0,configurable:!0,writable:!0,value:S}):h[p]=S;var w=(h,p,S)=>fe(h,typeof p!="symbol"?p+"":p,S);const p={ADD_COMPONENT:"ADD_COMPONENT",UPDATE_COMPONENT:"UPDATE_COMPONENT",DELETE_COMPONENT:"DELETE_COMPONENT",REMOVE_COMPONENT:"REMOVE_COMPONENT",MOVE_COMPONENT:"MOVE_COMPONENT",DUPLICATE_COMPONENT:"DUPLICATE_COMPONENT",UPDATE_COMPONENT_PROPS:"UPDATE_COMPONENT_PROPS",UPDATE_COMPONENT_CONTENT:"UPDATE_COMPONENT_CONTENT",BATCH_UPDATE_COMPONENTS:"BATCH_UPDATE_COMPONENTS",CLEAR_ALL_COMPONENTS:"CLEAR_ALL_COMPONENTS"},S={SET_LAYOUT:"SET_LAYOUT",UPDATE_LAYOUT_ORDER:"UPDATE_LAYOUT_ORDER",REORDER_COMPONENTS:"REORDER_COMPONENTS",UPDATE_COMPONENT_ORDER:"UPDATE_COMPONENT_ORDER"},f={ADD_SECTION:"ADD_SECTION",UPDATE_SECTION:"UPDATE_SECTION",DELETE_SECTION:"DELETE_SECTION",UPDATE_SECTIONS:"UPDATE_SECTIONS",MOVE_SECTION:"MOVE_SECTION",UPDATE_SECTION_LAYOUT:"UPDATE_SECTION_LAYOUT",ASSIGN_COMPONENT_TO_SECTION:"ASSIGN_COMPONENT_TO_SECTION",REMOVE_COMPONENT_FROM_SECTION:"REMOVE_COMPONENT_FROM_SECTION",REORDER_SECTION_COMPONENTS:"REORDER_SECTION_COMPONENTS"},N={SET_THEME:"SET_THEME",UPDATE_THEME:"UPDATE_THEME",UPDATE_THEME_SETTINGS:"UPDATE_THEME_SETTINGS",RESET_THEME:"RESET_THEME",APPLY_CUSTOM_THEME:"APPLY_CUSTOM_THEME"},D={UPDATE_GLOBAL_SETTINGS:"UPDATE_GLOBAL_SETTINGS",SET_GLOBAL_SETTINGS:"SET_GLOBAL_SETTINGS",UPDATE_LAYOUT_MODE:"UPDATE_LAYOUT_MODE",UPDATE_RESPONSIVE_SETTINGS:"UPDATE_RESPONSIVE_SETTINGS",UPDATE_META_SETTINGS:"UPDATE_META_SETTINGS"},g={SET_STATE:"SET_STATE",RESET_STATE:"RESET_STATE",LOAD_STATE:"LOAD_STATE",MERGE_STATE:"MERGE_STATE",IMPORT_STATE:"IMPORT_STATE",EXPORT_STATE:"EXPORT_STATE",CLEAR_STATE:"CLEAR_STATE"},X={START_BATCH:"START_BATCH",END_BATCH:"END_BATCH",COMMIT_TRANSACTION:"COMMIT_TRANSACTION",ROLLBACK_TRANSACTION:"ROLLBACK_TRANSACTION"},b={SAVE_STATE:"SAVE_STATE",SAVE_STATE_SUCCESS:"SAVE_STATE_SUCCESS",SAVE_STATE_FAILURE:"SAVE_STATE_FAILURE",LOAD_STATE_REQUEST:"LOAD_STATE_REQUEST",LOAD_STATE_SUCCESS:"LOAD_STATE_SUCCESS",LOAD_STATE_FAILURE:"LOAD_STATE_FAILURE",AUTO_SAVE:"AUTO_SAVE",MANUAL_SAVE:"MANUAL_SAVE"},T={...p,...S,...f,...N,...D,...g,...X,...b,...{SELECT_COMPONENT:"SELECT_COMPONENT",DESELECT_COMPONENT:"DESELECT_COMPONENT",HOVER_COMPONENT:"HOVER_COMPONENT",FOCUS_COMPONENT:"FOCUS_COMPONENT",OPEN_COMPONENT_SETTINGS:"OPEN_COMPONENT_SETTINGS",CLOSE_COMPONENT_SETTINGS:"CLOSE_COMPONENT_SETTINGS",TOGGLE_PREVIEW_MODE:"TOGGLE_PREVIEW_MODE"},...{UNDO:"UNDO",REDO:"REDO",ADD_TO_HISTORY:"ADD_TO_HISTORY",CLEAR_HISTORY:"CLEAR_HISTORY",SET_HISTORY_POINTER:"SET_HISTORY_POINTER"},...{SET_ERROR:"SET_ERROR",CLEAR_ERROR:"CLEAR_ERROR",LOG_ERROR:"LOG_ERROR"}},M=s=>Object.values(T).includes(s),u=(s,e,t={})=>(M(s)||console.warn(`Invalid action type: ${s}`),{type:s,payload:e,meta:{...t,timestamp:Date.now(),id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}),A={components:{},layout:[],sections:[],theme:"default",themeSettings:{},globalSettings:{layout:"vertical",responsive:!0,autoSave:!0,autoSaveInterval:3e4},ui:{selectedComponent:null,hoveredComponent:null,isPreviewMode:!1,isSaving:!1,lastSaved:null},history:{past:[],future:[],maxHistorySize:50},meta:{version:"2.2.0",lastModified:null,createdAt:null,author:null},errors:[]};function I(s=A,e){var n;if((n=window.gmkbData)!=null&&n.debugMode&&console.log("🔄 Reducer:",e.type,e.payload),!M(e.type))return console.warn(`Unknown action type: ${e.type}`),s;let t={...s};switch(e.type){case p.ADD_COMPONENT:{const o=e.payload;if(!o.id)return console.error("ADD_COMPONENT: Component must have an id"),s;const a={id:o.id,type:o.type||"unknown",props:o.props||{},content:o.content||{},sectionId:o.sectionId||null,order:o.order||t.layout.length,createdAt:o.createdAt||Date.now(),updatedAt:Date.now(),...o};t.components={...t.components,[o.id]:a},t.layout.includes(o.id)||(t.layout=[...t.layout,o.id]),o.sectionId&&(t=Z(t,o.id,o.sectionId));break}case p.UPDATE_COMPONENT:{const{id:o,updates:a}=e.payload;if(!t.components[o])return console.warn(`UPDATE_COMPONENT: Component ${o} not found`),s;t.components={...t.components,[o]:{...t.components[o],...a,updatedAt:Date.now()}};break}case p.DELETE_COMPONENT:case p.REMOVE_COMPONENT:{const o=typeof e.payload=="string"?e.payload:e.payload.id;if(!t.components[o])return console.warn(`DELETE_COMPONENT: Component ${o} not found`),s;const a=t.components[o],{[o]:i,...c}=t.components;t.components=c,t.layout=t.layout.filter(d=>d!==o),a.sectionId&&(t=ee(t,o,a.sectionId));break}case p.MOVE_COMPONENT:{const{componentId:o,direction:a,targetIndex:i}=e.payload,c=t.layout.indexOf(o);if(c===-1)return console.warn(`MOVE_COMPONENT: Component ${o} not in layout`),s;const d=[...t.layout];typeof i=="number"?(d.splice(c,1),d.splice(i,0,o)):a==="up"&&c>0?[d[c],d[c-1]]=[d[c-1],d[c]]:a==="down"&&c<d.length-1&&([d[c],d[c+1]]=[d[c+1],d[c]]),t.layout=d;break}case p.DUPLICATE_COMPONENT:{const{componentId:o,newId:a}=e.payload,i=t.components[o];if(!i)return console.warn(`DUPLICATE_COMPONENT: Component ${o} not found`),s;const c=a||`${o}_copy_${Date.now()}`,d={...i,id:c,createdAt:Date.now(),updatedAt:Date.now()};t.components={...t.components,[c]:d};const m=t.layout.indexOf(o);t.layout=[...t.layout.slice(0,m+1),c,...t.layout.slice(m+1)];break}case p.BATCH_UPDATE_COMPONENTS:{const o=e.payload,a={...t.components};Object.entries(o).forEach(([i,c])=>{a[i]&&(a[i]={...a[i],...c,updatedAt:Date.now()})}),t.components=a;break}case p.CLEAR_ALL_COMPONENTS:{t.components={},t.layout=[],t.sections=t.sections.map(o=>({...o,components:[]}));break}case S.SET_LAYOUT:{const o=e.payload,a=o.filter(i=>t.components[i]);a.length!==o.length&&console.warn("SET_LAYOUT: Some component IDs do not exist, filtered invalid IDs"),t.layout=a;break}case S.UPDATE_LAYOUT_ORDER:case S.REORDER_COMPONENTS:{const{fromIndex:o,toIndex:a}=e.payload,i=[...t.layout],[c]=i.splice(o,1);i.splice(a,0,c),t.layout=i;break}case f.ADD_SECTION:{const o={section_id:e.payload.section_id||`section_${Date.now()}`,section_type:e.payload.section_type||"full_width",components:e.payload.components||[],layout:e.payload.layout||{},section_options:e.payload.section_options||{},created_at:Date.now(),updated_at:Date.now(),...e.payload};t.sections=[...t.sections,o];break}case f.UPDATE_SECTION:{const{sectionId:o,updates:a}=e.payload;t.sections=t.sections.map(i=>i.section_id===o?{...i,...a,updated_at:Date.now()}:i);break}case f.DELETE_SECTION:{const o=e.payload,a=t.sections.find(i=>i.section_id===o);a&&a.components&&a.components.forEach(i=>{const c=i.component_id||i;t.components[c]&&(t.components[c].sectionId=null)}),t.sections=t.sections.filter(i=>i.section_id!==o);break}case f.UPDATE_SECTIONS:{t.sections=e.payload;break}case N.SET_THEME:{t.theme=e.payload;break}case N.UPDATE_THEME_SETTINGS:{t.themeSettings={...t.themeSettings,...e.payload};break}case D.UPDATE_GLOBAL_SETTINGS:{t.globalSettings={...t.globalSettings,...e.payload};break}case g.SET_STATE:{t={...A,...e.payload,meta:{...A.meta,...e.payload.meta,lastModified:Date.now()}};break}case g.RESET_STATE:{t={...A};break}case g.MERGE_STATE:{t=B(t,e.payload);break}case b.SAVE_STATE_SUCCESS:{t.ui={...t.ui,isSaving:!1,lastSaved:Date.now()};break}case b.SAVE_STATE_FAILURE:{t.ui={...t.ui,isSaving:!1},t.errors=[...t.errors,{type:"SAVE_ERROR",message:e.payload.message||"Failed to save state",timestamp:Date.now()}];break}case"SELECT_COMPONENT":{t.ui={...t.ui,selectedComponent:e.payload};break}case"DESELECT_COMPONENT":{t.ui={...t.ui,selectedComponent:null};break}case"TOGGLE_PREVIEW_MODE":{t.ui={...t.ui,isPreviewMode:!t.ui.isPreviewMode};break}case"ADD_TO_HISTORY":{const{past:o}=t.history,a=t.history.maxHistorySize;t.history={...t.history,past:[...o.slice(-(a-1)),e.payload],future:[]};break}case"UNDO":{const{past:o,future:a}=t.history;if(o.length===0)return s;t=o[o.length-1],t.history={...t.history,past:o.slice(0,-1),future:[s,...a]};break}case"REDO":{const{past:o,future:a}=t.history;if(a.length===0)return s;t=a[0],t.history={...t.history,past:[...o,s],future:a.slice(1)};break}default:return s}return t.meta={...t.meta,lastModified:Date.now()},t}function Z(s,e,t){const n=s.sections.map(o=>{if(o.section_id===t){const a=o.components||[];if(!a.some(c=>(typeof c=="string"?c:c.component_id)===e))return{...o,components:[...a,{component_id:e,column:1,order:a.length,assigned_at:Date.now()}],updated_at:Date.now()}}return o});return{...s,sections:n}}function ee(s,e,t){const n=s.sections.map(o=>o.section_id===t?{...o,components:o.components.filter(a=>(typeof a=="string"?a:a.component_id)!==e),updated_at:Date.now()}:o);return{...s,sections:n}}function B(s,e){const t={...s};return L(s)&&L(e)&&Object.keys(e).forEach(n=>{L(e[n])&&n in s?t[n]=B(s[n],e[n]):t[n]=e[n]}),t}function L(s){return s&&typeof s=="object"&&!Array.isArray(s)}class ${constructor(e={}){w(this,"loggingMiddleware",(e,t,n)=>(console.group(`🔄 Action: ${t.type}`),console.log("Payload:",t.payload),console.log("Previous State:",e),console.log("Meta:",t.meta),console.groupEnd(),t));w(this,"validationMiddleware",(e,t,n)=>{if(M(t.type)||console.warn(`Invalid action type: ${t.type}`),t.type===p.ADD_COMPONENT){const o=t.payload;if(!o.id)return console.error("Component must have an id"),!1;o.type||console.warn("Component should have a type")}return t});w(this,"persistenceMiddleware",(e,t,n)=>(["SELECT_COMPONENT","DESELECT_COMPONENT","HOVER_COMPONENT","FOCUS_COMPONENT"].includes(t.type)||(n.saveTimeout&&clearTimeout(n.saveTimeout),n.saveTimeout=setTimeout(()=>{n.saveToStorage()},1e3)),t));var n;this.state=I(void 0,{type:"@@INIT"});const t=this.processWordPressData(e);t&&Object.keys(t).length>0&&(this.state=I(this.state,u(g.MERGE_STATE,t))),this.listeners=new Set,this.middleware=[],this.isBatching=!1,this.batchQueue=[],(n=window.gmkbData)!=null&&n.debugMode&&this.addMiddleware(this.loggingMiddleware),this.addMiddleware(this.validationMiddleware),this.addMiddleware(this.persistenceMiddleware),console.log("✅ Enhanced State Manager initialized with reducer pattern")}dispatch(e){if(!e.type){console.error("Action must have a type property",e);return}if(e.meta||(e.meta={timestamp:Date.now(),id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}),this.isBatching){this.batchQueue.push(e);return}let t=e;for(const o of this.middleware){const a=o(this.state,t,this);if(a===!1)return;a&&typeof a=="object"&&(t=a)}const n=this.state;this.state=I(this.state,t),this.state!==n&&(["UNDO","REDO","ADD_TO_HISTORY"].includes(t.type)||this.dispatch({type:"ADD_TO_HISTORY",payload:n}),this.notify())}addComponent(e){this.dispatch(u(p.ADD_COMPONENT,e))}updateComponent(e,t){this.dispatch(u(p.UPDATE_COMPONENT,{id:e,updates:t}))}removeComponent(e){this.dispatch(u(p.REMOVE_COMPONENT,e))}moveComponent(e,t){this.dispatch(u(p.MOVE_COMPONENT,{componentId:e,direction:t}))}duplicateComponent(e,t){this.dispatch(u(p.DUPLICATE_COMPONENT,{componentId:e,newId:t}))}setLayout(e){this.dispatch(u(S.SET_LAYOUT,e))}addSection(e){this.dispatch(u(f.ADD_SECTION,e))}updateSection(e,t){this.dispatch(u(f.UPDATE_SECTION,{sectionId:e,updates:t}))}deleteSection(e){this.dispatch(u(f.DELETE_SECTION,e))}setTheme(e){this.dispatch(u(N.SET_THEME,e))}updateGlobalSettings(e){this.dispatch(u(D.UPDATE_GLOBAL_SETTINGS,e))}setState(e){this.dispatch(u(g.SET_STATE,e))}resetState(){this.dispatch(u(g.RESET_STATE))}undo(){this.dispatch({type:"UNDO"})}redo(){this.dispatch({type:"REDO"})}startBatch(){this.isBatching=!0,this.batchQueue=[]}endBatch(){if(!this.isBatching)return;this.isBatching=!1;const e=[...this.batchQueue];this.batchQueue=[],e.forEach(t=>this.dispatch(t))}getState(){return JSON.parse(JSON.stringify(this.state))}getComponent(e){return this.state.components[e]}getComponents(){return Object.values(this.state.components)}getLayout(){return[...this.state.layout]}getSections(){return[...this.state.sections]}getTheme(){return this.state.theme}getGlobalSettings(){return{...this.state.globalSettings}}subscribe(e){return this.listeners.add(e),e(this.getState()),()=>{this.listeners.delete(e)}}notify(){const e=this.getState();this.listeners.forEach(t=>{try{t(e)}catch(n){console.error("Error in state listener:",n)}}),document.dispatchEvent(new CustomEvent("gmkb:state-changed",{detail:{state:e,timestamp:Date.now()}}))}addMiddleware(e){this.middleware.push(e)}saveToStorage(){try{const e={components:this.state.components,layout:this.state.layout,sections:this.state.sections,theme:this.state.theme,themeSettings:this.state.themeSettings,globalSettings:this.state.globalSettings,meta:this.state.meta};localStorage.setItem("gmkb_state",JSON.stringify(e)),this.dispatch({type:b.SAVE_STATE_SUCCESS}),console.log("✅ State saved to localStorage")}catch(e){console.error("Failed to save state:",e),this.dispatch({type:b.SAVE_STATE_FAILURE,payload:{message:e.message}})}}processWordPressData(e){if(!e||typeof e!="object")return{};if(e.components&&typeof e.components=="object")return e;if(e.saved_components&&Array.isArray(e.saved_components)){const t={},n=[];return e.saved_components.forEach(o=>{o&&o.id&&(t[o.id]=o,n.push(o.id))}),{components:t,layout:n,sections:e.sections||[],theme:e.theme||"default",globalSettings:e.globalSettings||e.global_settings||{},meta:{...e.meta,version:e.version||"2.2.0"}}}return e}loadFromStorage(){try{const e=localStorage.getItem("gmkb_state");if(e){const t=JSON.parse(e);return this.dispatch(u(g.MERGE_STATE,t)),console.log("✅ State loaded from localStorage"),!0}}catch(e){console.error("Failed to load state:",e)}return!1}debug(){console.group("%c🔍 Enhanced State Manager Debug","font-size: 14px; font-weight: bold; color: #4CAF50"),console.log("Current State:",this.getState()),console.log("Components:",Object.keys(this.state.components).length),console.log("Sections:",this.state.sections.length),console.log("Layout:",this.state.layout),console.log("Theme:",this.state.theme),console.log("Listeners:",this.listeners.size),console.log("History:",{past:this.state.history.past.length,future:this.state.history.future.length}),console.log("Is Batching:",this.isBatching),console.log("Batch Queue:",this.batchQueue.length),console.groupEnd()}}class x{constructor(){this.events=new Map}on(e,t){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t),()=>this.off(e,t)}off(e,t){this.events.has(e)&&this.events.get(e).delete(t)}emit(e,t){console.log("📢 Event:",e,t),this.events.has(e)&&this.events.get(e).forEach(n=>{try{n(t)}catch(o){console.error(`Error in ${e} handler:`,o)}})}once(e,t){const n=o=>{t(o),this.off(e,n)};return this.on(e,n)}}const C={},H={};function G(s,e,t=null){return C[s]=e,t&&(H[s]=t),console.log(`✅ Registered component: ${s}`),!0}function k(s){return s in C}function V(s){if(!k(s))return console.warn(`Component type "${s}" not found in registry`),j(s);const e=C[s];return typeof e=="object"&&e.render?e.render:e}function te(s){return H[s]||null}function j(s){return function(t){const n=t.data||t.props||{};let o="";switch(s){case"hero":o=`
          <div class="gmkb-hero">
            <h1>${n.title||n.full_name||"Guest Name"}</h1>
            ${n.subtitle?`<h2>${n.subtitle}</h2>`:""}
            ${n.description?`<p>${n.description}</p>`:""}
          </div>
        `;break;case"biography":o=`
          <div class="gmkb-biography">
            <h2>Biography</h2>
            <p>${n.biography||"No biography available."}</p>
          </div>
        `;break;case"topics":const i=n.topics||[];o=`
          <div class="gmkb-topics">
            <h2>Topics</h2>
            ${i.length>0?`<ul>${i.map(d=>`<li>${d}</li>`).join("")}</ul>`:"<p>No topics available.</p>"}
          </div>
        `;break;case"contact":o=`
          <div class="gmkb-contact">
            <h2>Contact</h2>
            ${n.email?`<p>Email: ${n.email}</p>`:""}
            ${n.phone?`<p>Phone: ${n.phone}</p>`:""}
            ${n.website?`<p>Website: ${n.website}</p>`:""}
          </div>
        `;break;case"cta":case"call-to-action":o=`
          <div class="gmkb-cta">
            <h2>${n.title||"Call to Action"}</h2>
            ${n.description?`<p>${n.description}</p>`:""}
            ${n.button_text?`<button class="btn btn-primary">${n.button_text}</button>`:""}
          </div>
        `;break;case"testimonials":const c=n.testimonials||[];o=`
          <div class="gmkb-testimonials">
            <h2>Testimonials</h2>
            ${c.length>0?c.map(d=>`
                <blockquote>
                  <p>${d.text||""}</p>
                  <cite>- ${d.author||"Anonymous"}</cite>
                </blockquote>
              `).join(""):"<p>No testimonials available.</p>"}
          </div>
        `;break;default:o=`
          <div class="gmkb-component gmkb-component--${s}">
            <h3>${s.charAt(0).toUpperCase()+s.slice(1)} Component</h3>
            <pre>${JSON.stringify(n,null,2)}</pre>
          </div>
        `}const a=document.createElement("div");return a.innerHTML=o,a.firstElementChild}}async function oe(){return["hero","biography","topics","contact","cta","testimonials"].forEach(e=>{k(e)||G(e,j(e))}),console.log("✅ Component renderers loaded:",Object.keys(C)),C}typeof window<"u"&&(window.GMKBComponentRegistry={register:G,get:V,has:k,getSchema:te});const _={info:(...s)=>console.log("ℹ️",...s),warn:(...s)=>console.warn("⚠️",...s),error:(...s)=>console.error("❌",...s),success:(...s)=>console.log("✅",...s),debug:(...s)=>{var e;(e=window.gmkbData)!=null&&e.debugMode&&console.log("🐛",...s)}};class z{constructor(e,t="media-kit-preview"){if(this.stateManager=e,this.container=document.getElementById(t),!this.container){_.error(`Container #${t} not found`);return}const n=document.getElementById("empty-state"),o=document.getElementById("saved-components-container");n&&(n.style.display="none"),o&&(o.style.display="block"),this.unsubscribe=this.stateManager.subscribe(()=>this.render()),this.render()}render(){const e=this.stateManager.getState();_.debug("🎨 Rendering state:",e);const t=Object.keys(e.components).length>0,n=e.sections&&e.sections.length>0,o=document.getElementById("empty-state"),a=document.getElementById("saved-components-container");if(!t&&!n){o&&(o.style.display="block"),a&&(a.style.display="none"),this.renderEmptyState();return}o&&(o.style.display="none"),a&&(a.style.display="block"),this.container.innerHTML="",(this.container.id==="media-kit-preview"||this.container.id==="gmkb-preview-area")&&(this.container.className=`preview-area theme-${e.theme||"default"}`),n?this.renderSections(e):t&&this.renderComponentsDirectly(e)}renderSections(e){e.sections.forEach(t=>{const n=this.renderSection(t,e);n&&this.container.appendChild(n)})}renderSection(e,t){const n=document.createElement("div");n.className=`gmkb-section gmkb-section--${e.type||"full-width"}`,n.setAttribute("data-section-id",e.section_id);const o=document.createElement("div");return o.className="gmkb-section__content",e.components&&e.components.length>0?e.components.forEach(a=>{const i=t.components[a];if(i){const c=this.renderComponent(i);c&&o.appendChild(c)}}):o.innerHTML=`
        <div class="gmkb-section__empty" data-drop-zone="true">
          <p>Drop components here</p>
        </div>
      `,this.addSectionControls(n,e),n.appendChild(o),n}renderComponentsDirectly(e){Object.values(e.components).forEach(t=>{const n=this.renderComponent(t);n&&this.container.appendChild(n)})}renderComponent(e){const t=V(e.type);if(!t)return _.warn(`No renderer for component type: ${e.type}`),this.renderFallbackComponent(e);try{let n;if(typeof t=="function")n=t(e);else if(t.render)n=t.render(e);else throw new Error("Invalid renderer format");if(typeof n=="string"){const a=document.createElement("div");a.innerHTML=n,n=a.firstElementChild||a}const o=document.createElement("div");return o.className=`gmkb-component gmkb-component--${e.type}`,o.setAttribute("data-component-id",e.id),o.setAttribute("data-component-type",e.type),this.addComponentControls(o,e),o.appendChild(n),o}catch(n){return _.error(`Error rendering component ${e.id}:`,n),this.renderFallbackComponent(e)}}renderFallbackComponent(e){const t=document.createElement("div");return t.className=`gmkb-component gmkb-component--${e.type} gmkb-component--fallback`,t.setAttribute("data-component-id",e.id),t.innerHTML=`
      <div class="component-fallback">
        <h4>${e.type}</h4>
        <p>Component ID: ${e.id}</p>
      </div>
    `,this.addComponentControls(t,e),t}addComponentControls(e,t){const n=document.createElement("div");n.className="component-controls",n.innerHTML=`
      <button class="control-btn move-up" data-action="move-up" title="Move Up">↑</button>
      <button class="control-btn move-down" data-action="move-down" title="Move Down">↓</button>
      <button class="control-btn edit" data-action="edit" title="Edit">✏️</button>
      <button class="control-btn duplicate" data-action="duplicate" title="Duplicate">📋</button>
      <button class="control-btn delete" data-action="delete" title="Delete">🗑️</button>
    `,n.addEventListener("click",o=>{const a=o.target.dataset.action;a&&this.handleComponentAction(a,t.id)}),e.appendChild(n)}addSectionControls(e,t){const n=document.createElement("div");n.className="section-controls",n.innerHTML=`
      <button class="control-btn delete" data-action="delete-section" title="Delete Section">🗑️</button>
      <button class="control-btn settings" data-action="section-settings" title="Section Settings">⚙️</button>
    `,n.addEventListener("click",o=>{const a=o.target.dataset.action;a&&this.handleSectionAction(a,t.section_id)}),e.appendChild(n)}handleComponentAction(e,t){document.dispatchEvent(new CustomEvent("gmkb:component-action",{detail:{action:e,componentId:t}}))}handleSectionAction(e,t){document.dispatchEvent(new CustomEvent("gmkb:section-action",{detail:{action:e,sectionId:t}}))}renderEmptyState(){const e=document.getElementById("empty-state");if(e){const n=e.querySelector("#add-first-component"),o=e.querySelector("#add-first-section");n&&!n.hasAttribute("data-listener-attached")&&(n.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("gmkb:open-component-library"))}),n.setAttribute("data-listener-attached","true")),o&&!o.hasAttribute("data-listener-attached")&&(o.addEventListener("click",()=>{this.addSection()}),o.setAttribute("data-listener-attached","true"));return}this.container.innerHTML=`
      <div class="gmkb-empty-state">
        <h3>No components yet</h3>
        <p>Click "Add Component" to get started</p>
        <button id="empty-state-add-btn" class="btn btn-primary">Add Component</button>
      </div>
    `;const t=this.container.querySelector("#empty-state-add-btn");t&&t.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("gmkb:open-component-library"))})}addSection(){const t={section_id:`section_${Date.now()}`,type:"full_width",components:[]};this.stateManager.dispatch({type:"ADD_SECTION",payload:t})}destroy(){this.unsubscribe&&this.unsubscribe()}}class F{constructor(e,t,n){var o,a,i;this.ajaxUrl=e||((o=window.gmkbData)==null?void 0:o.ajaxUrl),this.nonce=t||((a=window.gmkbData)==null?void 0:a.nonce),this.postId=n||((i=window.gmkbData)==null?void 0:i.postId)}async save(e){var n;const t=new FormData;t.append("action","gmkb_save_media_kit"),t.append("nonce",this.nonce),t.append("post_id",this.postId),t.append("state",JSON.stringify(e));try{const o=await fetch(this.ajaxUrl,{method:"POST",body:t});if(!o.ok)throw new Error(`Save failed: ${o.statusText}`);const a=await o.json();if(!a.success)throw new Error(((n=a.data)==null?void 0:n.message)||"Save failed");return a.data}catch(o){throw console.error("Save failed:",o),o}}async load(){var t;const e=new FormData;e.append("action","gmkb_load_media_kit"),e.append("nonce",this.nonce),e.append("post_id",this.postId);try{const n=await fetch(this.ajaxUrl,{method:"POST",body:e});if(!n.ok)throw new Error(`Load failed: ${n.statusText}`);const o=await n.json();if(!o.success)throw new Error(((t=o.data)==null?void 0:t.message)||"Load failed");return o.data}catch(n){return console.error("Load failed:",n),null}}async loadComponent(e){var n;const t=new FormData;t.append("action","gmkb_load_component"),t.append("nonce",this.nonce),t.append("component_id",e),t.append("post_id",this.postId);try{const a=await(await fetch(this.ajaxUrl,{method:"POST",body:t})).json();if(!a.success)throw new Error(((n=a.data)==null?void 0:n.message)||"Load failed");return a.data}catch(o){return console.error("Component load failed:",o),null}}}let l,Y,P,q;function E(s,e="info",t=3e3){const n=document.createElement("div");n.className=`toast toast--${e}`,n.textContent=s,document.body.appendChild(n),setTimeout(()=>{n.classList.add("toast--visible")},10),setTimeout(()=>{n.classList.remove("toast--visible"),setTimeout(()=>n.remove(),300)},t)}function ne(s){E(s,"error",5e3)}async function K(){var s,e,t,n,o;_.info("🚀 Initializing Media Kit Builder v3.0");try{Y=new x,P=new F((s=window.gmkbData)==null?void 0:s.ajaxUrl,(e=window.gmkbData)==null?void 0:e.nonce,(t=window.gmkbData)==null?void 0:t.postId),await oe();const a=((n=window.gmkbData)==null?void 0:n.savedState)||((o=window.gmkbData)==null?void 0:o.saved_state)||{};a.components||(a.components={}),(!a.sections||!Array.isArray(a.sections))&&(a.sections=[],Object.keys(a.components).length>0&&(a.sections=[{section_id:`section_${Date.now()}`,type:"full_width",components:Object.keys(a.components)}])),l=new $(a),l.loadFromStorage();const i=["gmkb-sections-container","saved-components-container","media-kit-preview","gmkb-preview-area"];let c="media-kit-preview";for(const d of i)if(document.getElementById(d)){c=d,_.info(`Using container: ${d}`);break}q=new z(l,c),J(),ae(),ce(),window.GMKB={stateManager:l,eventBus:Y,apiService:P,renderer:q,version:"3.0.0",addComponent:(d,m={})=>{const r=`${d}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,O={id:r,type:d,data:m,props:m},v=l.getState();if(v.sections.length===0){const y=`section_${Date.now()}`;l.dispatch({type:T.ADD_SECTION,payload:{section_id:y,type:"full_width",components:[]}}),O.sectionId=y}else O.sectionId=v.sections[0].section_id;return l.dispatch({type:T.ADD_COMPONENT,payload:O}),r},removeComponent:d=>{l.dispatch({type:T.REMOVE_COMPONENT,payload:d})},save:()=>R(),getState:()=>l.getState()},_.success("Media Kit Builder initialized successfully"),document.dispatchEvent(new CustomEvent("gmkb:ready",{detail:{version:"3.0.0"}}))}catch(a){_.error("Initialization failed:",a),ne("Failed to initialize Media Kit Builder")}}function J(){if(console.log("Setting up UI handlers..."),!document.getElementById("gmkb-toolbar")){console.warn("Toolbar not found, retrying..."),setTimeout(J,100);return}console.log("Toolbar found, attaching handlers..."),se();const e=document.getElementById("save-btn");e&&e.addEventListener("click",async()=>{await R()});const t=document.getElementById("add-component-btn")||document.getElementById("add-first-component")||document.querySelector('[data-action="add-component"]');t&&t.addEventListener("click",()=>{U()});const n=document.getElementById("add-section-btn")||document.getElementById("add-first-section")||document.getElementById("add-first-section-2")||document.querySelector('[data-action="add-section"]');n&&n.addEventListener("click",()=>{Q()}),document.querySelectorAll("[data-action]").forEach(r=>{const O=r.dataset.action;O==="add-component"&&!r.hasEventListener?(r.addEventListener("click",()=>U()),r.hasEventListener=!0):O==="add-section"&&!r.hasEventListener&&(r.addEventListener("click",()=>Q()),r.hasEventListener=!0)});const o=document.getElementById("global-theme-btn");o?(o.onclick=function(r){r.preventDefault(),console.log("Theme button clicked!"),Ee()},console.log("✓ Theme button handler attached (onclick)")):console.warn("Theme button not found");const a=document.getElementById("export-btn");a?(a.onclick=function(r){r.preventDefault(),console.log("Export button clicked!"),he()},console.log("✓ Export button handler attached (onclick)")):console.warn("Export button not found");const i=document.getElementById("share-btn");i?(i.onclick=function(r){r.preventDefault(),console.log("Share button clicked!"),Te()},console.log("✓ Share button handler attached (onclick)")):console.warn("Share button not found");const c=document.getElementById("undo-btn"),d=document.getElementById("redo-btn");c?(c.onclick=function(r){r.preventDefault(),console.log("Undo button clicked!"),E("Undo functionality coming soon","info")},console.log("✓ Undo button handler attached (onclick)")):console.warn("Undo button not found"),d?(d.onclick=function(r){r.preventDefault(),console.log("Redo button clicked!"),E("Redo functionality coming soon","info")},console.log("✓ Redo button handler attached (onclick)")):console.warn("Redo button not found");const m=document.querySelectorAll(".toolbar__preview-btn");m.length>0?(m.forEach(r=>{r.onclick=function(O){O.preventDefault();const v=this.dataset.preview||this.textContent.toLowerCase();console.log(`Device preview clicked: ${v}`);const y=document.querySelector(".preview__container");y?(y.classList.remove("preview__container--desktop","preview__container--tablet","preview__container--mobile"),v==="tablet"?y.classList.add("preview__container--tablet"):v==="mobile"&&y.classList.add("preview__container--mobile"),console.log(`Preview classes: ${y.className}`)):console.warn("Preview container not found"),m.forEach(_e=>_e.classList.remove("toolbar__preview-btn--active")),this.classList.add("toolbar__preview-btn--active")}}),console.log(`✓ ${m.length} device preview button handlers attached (onclick)`)):console.warn("No device preview buttons found")}function se(){const s=document.querySelectorAll(".sidebar__tab"),e=document.querySelectorAll(".tab-content");s.forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.tab;s.forEach(o=>o.classList.remove("sidebar__tab--active")),t.classList.add("sidebar__tab--active"),e.forEach(o=>{o.classList.remove("tab-content--active"),o.id===`${n}-tab`&&o.classList.add("tab-content--active")})})})}function ae(){ie(),document.addEventListener("gmkb:component-action",s=>{const{action:e,componentId:t}=s.detail;switch(e){case"delete":confirm("Delete this component?")&&l.dispatch({type:T.REMOVE_COMPONENT,payload:t});break;case"duplicate":le(t);break;case"edit":pe(t);break;case"move-up":W(t,-1);break;case"move-down":W(t,1);break}}),document.addEventListener("gmkb:section-action",s=>{const{action:e,sectionId:t}=s.detail;switch(e){case"delete-section":confirm("Delete this section and all its components?")&&re(t);break;case"section-settings":me(t);break}}),document.addEventListener("gmkb:open-component-library",U)}function ie(){document.querySelectorAll('.component-item[draggable="true"]').forEach(e=>{e.addEventListener("dragstart",t=>{const n=e.dataset.component;t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/plain",n),t.dataTransfer.setData("application/json",JSON.stringify({type:"new-component",componentType:n})),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging")}),e.addEventListener("click",()=>{const t=e.dataset.component;window.GMKB.addComponent(t),E(`Added ${t} component`,"success")})});const s=document.getElementById("media-kit-preview")||document.getElementById("gmkb-sections-container");s&&(s.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy",s.classList.add("drag-over")}),s.addEventListener("dragleave",()=>{s.classList.remove("drag-over")}),s.addEventListener("drop",e=>{e.preventDefault(),s.classList.remove("drag-over");const t=e.dataTransfer.getData("text/plain");t&&(window.GMKB.addComponent(t),E(`Added ${t} component`,"success"))}))}function ce(){let s;l.subscribe(()=>{clearTimeout(s),s=setTimeout(()=>{R(!0)},5e3)})}async function R(s=!1){const e=document.getElementById("save-btn");!s&&e&&(e.disabled=!0,e.textContent="Saving...");try{const t=l.getState();await P.save(t),s||E("Saved successfully","success"),_.success("State saved")}catch(t){_.error("Save failed:",t),s||E("Save failed","error")}finally{!s&&e&&(e.disabled=!1,e.textContent="Save")}}function U(){let s=document.getElementById("component-library-modal");s||(s=document.createElement("div"),s.id="component-library-modal",s.className="modal",s.innerHTML=`
      <div class="modal__content">
        <div class="modal__header">
          <h2 class="modal__title">Add Component</h2>
          <button class="modal__close">&times;</button>
        </div>
        <div class="modal__body" id="component-library-list"></div>
      </div>
    `,document.body.appendChild(s),s.querySelector(".modal__close").addEventListener("click",()=>{s.classList.remove("modal--open")}),s.addEventListener("click",e=>{e.target===s&&s.classList.remove("modal--open")})),s.classList.add("modal--open"),de(),console.log("Component library modal opened")}function de(){var t;const s=document.getElementById("component-library-list");if(!s)return;const e=((t=window.gmkbData)==null?void 0:t.components)||[{type:"hero",name:"Hero",description:"Hero section with title and image"},{type:"biography",name:"Biography",description:"Professional biography"},{type:"topics",name:"Topics",description:"Speaking topics list"},{type:"contact",name:"Contact",description:"Contact information"},{type:"cta",name:"Call to Action",description:"CTA button section"},{type:"testimonials",name:"Testimonials",description:"Client testimonials"}];s.innerHTML=e.map(n=>`
    <div class="component-card" data-component-type="${n.type}">
      <h3>${n.name}</h3>
      <p>${n.description}</p>
      <button class="btn btn-primary add-component-btn" data-type="${n.type}">
        Add ${n.name}
      </button>
    </div>
  `).join(""),s.querySelectorAll(".add-component-btn").forEach(n=>{n.addEventListener("click",()=>{const o=n.dataset.type;window.GMKB.addComponent(o);const a=document.getElementById("component-library-modal");a&&a.classList.remove("modal--open"),E(`Added ${o} component`,"success")})})}function Q(s="full_width"){const t={section_id:`section_${Date.now()}`,type:s,components:[]};l.dispatch({type:T.ADD_SECTION,payload:t}),E("Section added","success")}function re(s){const e=l.getState(),t=e.sections.filter(o=>o.section_id!==s),n=e.sections.find(o=>o.section_id===s);n&&n.components&&n.components.forEach(o=>{l.dispatch({type:T.REMOVE_COMPONENT,payload:o})}),l.dispatch({type:T.UPDATE_SECTIONS,payload:t})}function le(s){const t=l.getState().components[s];if(t){const n=`${t.type}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...t,id:n,data:{...t.data}};l.dispatch({type:T.ADD_COMPONENT,payload:o}),E("Component duplicated","success")}}function W(s,e){const t=l.getState(),n=t.components[s];if(!n||!n.sectionId)return;const o=t.sections.find(m=>m.section_id===n.sectionId);if(!o)return;const a=o.components.indexOf(s);if(a===-1)return;const i=a+e;if(i<0||i>=o.components.length)return;const c=[...o.components];[c[a],c[i]]=[c[i],c[a]];const d=t.sections.map(m=>m.section_id===o.section_id?{...m,components:c}:m);l.dispatch({type:T.UPDATE_SECTIONS,payload:d})}function pe(s){const e=l.getState().components[s];e&&(console.log("Edit component:",e),E("Component editor not yet implemented","info"))}function me(s){console.log("Edit section:",s),E("Section settings not yet implemented","info")}function Ee(){console.log("Opening advanced theme customizer..."),window.themeCustomizer&&typeof window.themeCustomizer.open=="function"?(window.themeCustomizer.open(),console.log("Advanced theme customizer opened")):window.openThemeSettings&&typeof window.openThemeSettings=="function"?(window.openThemeSettings(),console.log("Theme settings opened via alternative method")):(document.dispatchEvent(new CustomEvent("gmkb:open-theme-customizer",{detail:{source:"toolbar"}})),console.log("Dispatched open-theme-customizer event"),setTimeout(()=>{document.getElementById("theme-customizer-modal")||ue()},100))}function ue(){console.log("Opening simple theme modal as fallback...");const s=document.getElementById("theme-customizer-modal");s&&s.remove();let e=document.getElementById("gmkb-theme-modal");if(!e){e=document.createElement("div"),e.id="gmkb-theme-modal",e.className="modal",e.innerHTML=`
      <div class="modal__content">
        <div class="modal__header">
          <h2 class="modal__title">Customize Theme</h2>
          <button class="modal__close">&times;</button>
        </div>
        <div class="modal__body">
          <div class="theme-palette">
            <div class="palette-option palette-option--blue palette-option--active" data-theme="blue"></div>
            <div class="palette-option palette-option--green" data-theme="green"></div>
            <div class="palette-option palette-option--purple" data-theme="purple"></div>
            <div class="palette-option palette-option--orange" data-theme="orange"></div>
            <div class="palette-option palette-option--pink" data-theme="pink"></div>
            <div class="palette-option palette-option--gray" data-theme="gray"></div>
          </div>
          <p style="color: #94a3b8; font-size: 14px; margin-top: 20px;">Select a theme color above</p>
          <p style="color: #ef4444; font-size: 12px; margin-top: 10px;">Note: Advanced theme customizer is loading...</p>
        </div>
      </div>
    `,document.body.appendChild(e);const t=e.querySelector(".modal__close");t&&(t.onclick=function(n){n.preventDefault(),n.stopPropagation(),e.classList.remove("modal--open"),e.style.display="none"}),e.onclick=function(n){n.target===e&&(e.classList.remove("modal--open"),e.style.display="none")},e.querySelectorAll(".palette-option").forEach(n=>{n.onclick=function(o){o.preventDefault(),e.querySelectorAll(".palette-option").forEach(i=>{i.classList.remove("palette-option--active")}),this.classList.add("palette-option--active");const a=this.dataset.theme;console.log("Theme selected:",a),l&&l.dispatch({type:T.SET_THEME,payload:a}),E(`Theme changed to ${a}`,"success")}})}e.classList.add("modal--open"),e.style.display="flex"}function he(){console.log("Opening export modal...");const s=document.getElementById("export-modal");s&&s.remove();let e=document.getElementById("gmkb-export-modal");if(!e){e=document.createElement("div"),e.id="gmkb-export-modal",e.className="modal",e.innerHTML=`
      <div class="modal__content">
        <div class="modal__header">
          <h2 class="modal__title">Export Media Kit</h2>
          <button class="modal__close">&times;</button>
        </div>
        <div class="modal__body">
          <div class="export-options">
            <div class="export-option" data-format="json">
              <div class="export-option__icon">📄</div>
              <div class="export-option__title">JSON</div>
              <div class="export-option__description">For backup and import</div>
            </div>
            <div class="export-option" data-format="html">
              <div class="export-option__icon">🌐</div>
              <div class="export-option__title">HTML</div>
              <div class="export-option__description">Static webpage (coming soon)</div>
            </div>
            <div class="export-option" data-format="pdf">
              <div class="export-option__icon">📑</div>
              <div class="export-option__title">PDF</div>
              <div class="export-option__description">Document format (coming soon)</div>
            </div>
            <div class="export-option" data-format="link">
              <div class="export-option__icon">🔗</div>
              <div class="export-option__title">Share Link</div>
              <div class="export-option__description">Get shareable link (coming soon)</div>
            </div>
          </div>
        </div>
      </div>
    `,document.body.appendChild(e);const t=e.querySelector(".modal__close");t&&(t.onclick=function(n){n.preventDefault(),n.stopPropagation(),e.classList.remove("modal--open"),e.style.display="none"}),e.onclick=function(n){n.target===e&&(e.classList.remove("modal--open"),e.style.display="none")},e.querySelectorAll(".export-option").forEach(n=>{n.onclick=function(o){o.preventDefault();const a=this.dataset.format;if(a==="json"){if(!l){E("Export not ready","error");return}const i=l.getState(),c=JSON.stringify(i,null,2),d="data:application/json;charset=utf-8,"+encodeURIComponent(c),m=`media-kit-${Date.now()}.json`,r=document.createElement("a");r.setAttribute("href",d),r.setAttribute("download",m),r.click(),E("Media kit exported as JSON","success"),e.classList.remove("modal--open"),e.style.display="none"}else E(`${a.toUpperCase()} export coming soon`,"info")}})}e.classList.add("modal--open"),e.style.display="flex"}function Te(){console.log("Opening share modal...");let s=document.getElementById("share-modal");s||(s=document.createElement("div"),s.id="share-modal",s.className="modal",s.innerHTML=`
      <div class="modal__content">
        <div class="modal__header">
          <h2 class="modal__title">Share Media Kit</h2>
          <button class="modal__close">&times;</button>
        </div>
        <div class="modal__body">
          <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 48px; margin-bottom: 20px;">🔗</div>
            <h3 style="color: #e2e8f0; margin-bottom: 10px;">Share Feature Coming Soon!</h3>
            <p style="color: #94a3b8; font-size: 14px;">You'll be able to generate shareable links, embed codes, and collaborate with team members.</p>
          </div>
        </div>
      </div>
    `,document.body.appendChild(s),s.querySelector(".modal__close").addEventListener("click",()=>{s.classList.remove("modal--open")}),s.addEventListener("click",e=>{e.target===s&&s.classList.remove("modal--open")})),s.classList.add("modal--open")}return document.readyState==="loading"?document.addEventListener("DOMContentLoaded",K):setTimeout(K,0),h.APIService=F,h.EventBus=x,h.Renderer=z,h.StateManager=$,h.logger=_,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});
